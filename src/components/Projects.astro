---
/**
 * Projects Section — MUI brandingTheme.ts
 * Card grid with 3D tilt. Cards are fully clickable → open a near-fullscreen
 * detail modal designed strategically for recruiters & hiring managers.
 * Theme-aware (dark/light) via MUI CSS custom properties.
 */

interface ProjectLink {
  label: string;
  url: string;
  icon: string; // "github" | "play" | "external"
}

interface ProjectScreenshot {
  src: string;
  alt: string;
}

interface Project {
  title: string;
  subtitle: string;
  description: string;
  image: string;
  tags: string[];
  links: ProjectLink[];
  featured: boolean;
  status: string;
  projectType: string;
  // ── Recruiter-grade detail fields ──
  role: string;
  problemSolved: string;
  myContribution: string;
  fullDescription: string;
  keyFeatures: string[];
  achievements: string[];
  architecture: string;
  architectureLayers: { layer: string; detail: string }[];
  impact: string;
  screenshots: ProjectScreenshot[];
}

const projects: Project[] = [
  {
    title: "MeowApp",
    subtitle: "Open Source App — .NET MAUI",
    description:
      "Mobile app published on Google Play Store that allows exploring cat breeds through external API consumption.",
    image:
      "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/assets/images/posts/meow-dotnet-maui-the-art-of-connecting-with-thecatapi-part-1/cover.png",
    tags: [".NET MAUI", "MVVM", "REST API", "SQLite", "Clean Architecture", "GitHub Actions"],
    links: [
      {
        label: "Google Play",
        url: "https://play.google.com/store/apps/details?id=com.danielmonettelli.meow",
        icon: "play",
      },
      {
        label: "GitHub",
        url: "https://github.com/danielmonettelli/Meow",
        icon: "github",
      },
    ],
    featured: true,
    status: "Published",
    projectType: "Open Source Mobile App",
    role: "Lead developer and software architect",
    screenshots: [
      {
        src: "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/blog/assets/images/10_1_get_random_cat_images.png",
        alt: "Main screen — exploring random cat images",
      },
      {
        src: "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/blog/assets/images/10_1_get_cats_breeds.png",
        alt: "Breed catalog — browsing and searching cat breeds",
      },
      {
        src: "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/blog/assets/images/10_1_post_add_cat_to_favorites.png",
        alt: "Add to favorites — managing user's favorite cats",
      },
      {
        src: "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/blog/assets/images/10_1_get_list_favorite_cats.png",
        alt: "Favorites list — offline persistence with SQLite",
      },
    ],
    problemSolved:
      "The .NET MAUI ecosystem needed a real reference project — published in production — demonstrating how to build a complete app with best practices: Clean Architecture, REST API consumption, offline persistence, and automated CI/CD. Not a demo, but a real product.",
    myContribution:
      "I designed and developed the app from scratch autonomously: defined the 4-layer architecture, implemented the entire data flow (HTTP → Cache → UI), configured the CI/CD pipeline with GitHub Actions, and published the app on Google Play Store. Additionally, I documented the entire process in a series of technical blog articles.",
    fullDescription:
      "MeowApp is a mobile application successfully published on Google Play Store that demonstrates complete mastery of the mobile development lifecycle — from architectural design to production deployment. The app consumes TheCatAPI to offer a rich cat breed exploration experience, implementing local caching with SQLite for offline functionality, advanced state management, and professional UI/UX following Material Design guidelines adapted to the .NET MAUI ecosystem.",
    keyFeatures: [
      "Professional TheCatAPI (REST) consumption with robust error handling, retries, and timeout",
      "Offline caching with SQLite for data persistence and offline experience",
      "MVVM architecture with strictly separated 4-layer Clean Architecture",
      "Smooth tab navigation with proper lifecycle management",
      "Automated CI/CD with GitHub Actions for building, testing, and deployment",
      "Series of technical articles documenting every architecture and development decision",
    ],
    achievements: [
      "App published and available on Google Play Store with active users",
      "Open source project referenced by the .NET MAUI community on GitHub",
      "Complete series of technical blog posts documenting the process",
      "Demonstrates end-to-end mastery: design → architecture → development → testing → deployment",
    ],
    architecture:
      "4-layer Clean Architecture with strict MVVM pattern, dependency injection, and absolute separation of concerns.",
    architectureLayers: [
      { layer: "Domain", detail: "Business entities, repository interfaces, and service contracts" },
      { layer: "Application", detail: "Use cases, DTOs, orchestration logic, and validations" },
      { layer: "Infrastructure", detail: "HTTP implementations (HttpClient), SQLite, platform services" },
      { layer: "Presentation", detail: "XAML Views, ViewModels, Converters, navigation, and DI container" },
    ],
    impact:
      "Technical reference for .NET MAUI community developers who need a real example of how to take an app from idea to Google Play Store with professional standards.",
  },
  {
    title: "SAIP Platform & TTAIP Appeals",
    subtitle: "Academic Innovation Project",
    description:
      "Comprehensive solution to modernize the right to Public Information Access, digitizing the complete cycle of requests and appeals.",
    image:
      "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/assets/images/Daniel_Monettelli.png",
    tags: ["Spring Boot", "Angular", "Kotlin", "Android", "SQL Server", "RUP", "IBM Rhapsody"],
    links: [],
    featured: true,
    status: "In Development",
    projectType: "Government Web + Mobile Platform",
    role: "Full Stack Developer and architect of the comprehensive solution",
    screenshots: [],
    problemSolved:
      "In Peru, the Public Information Access (SAIP) process and its appeals before the TTAIP are bureaucratic procedures managed manually, causing delays, document loss, and lack of transparency. There was no digital platform covering the complete process cycle.",
    myContribution:
      "I led the design and implementation of the entire solution: modeled processes with professional UML (IBM Rhapsody), designed the database normalized to 3NF, built the RESTful API with Spring Boot, developed the SPA frontend with Angular, and created the native mobile app in Kotlin. Applied RUP methodology across all development phases.",
    fullDescription:
      "Academic innovation project that digitizes the constitutional right to Public Information Access in Peru. It covers the complete SAIP process cycle: from citizen request to appeal resolution before the TTAIP, with three interconnected modules — web management platform (Angular), RESTful backend (Spring Boot), and native mobile application (Kotlin for Android) — all integrated on a SQL Server database normalized to 3NF.",
    keyFeatures: [
      "Robust RESTful backend with Spring Boot (Java), secure authentication, and role management",
      "Complete SPA frontend with Angular, responsive design, and state management",
      "Native Android application in Kotlin with XML Layouts and Material Design",
      "SQL Server database normalized to 3NF with complete referential integrity",
      "Professional UML modeling with IBM Rhapsody: use cases, class and sequence diagrams",
      "Complete RUP methodology: inception, elaboration, construction, and transition",
    ],
    achievements: [
      "Complete digitization of a real constitutional government process",
      "Successful integration of 3 heterogeneous platforms (web + API + mobile)",
      "Database normalized to 3NF with 20+ interrelated tables",
      "Exhaustive technical documentation following RUP standard with artifacts from each phase",
    ],
    architecture:
      "Service architecture with central RESTful API, SPA frontend, and native mobile module.",
    architectureLayers: [
      { layer: "Backend (Spring Boot)", detail: "REST API, JWT authentication, business logic, data validation" },
      { layer: "Frontend (Angular)", detail: "SPA with reusable components, HTTP services, route guards" },
      { layer: "Mobile (Kotlin)", detail: "Native Android app with Retrofit, Room, and MVVM pattern" },
      { layer: "Database (SQL Server)", detail: "3NF normalized schema, stored procedures, triggers" },
    ],
    impact:
      "Solution that modernizes a real government process, potentially benefiting millions of Peruvian citizens in their constitutional right to public information access.",
  },
  {
    title: "Aloha Patitas",
    subtitle: "Pet-Friendly Tourism Platform",
    description:
      "Pioneer solution for finding pet-friendly tourism services. ASP.NET Core backend, MVC Razor Views web, and .NET MAUI mobile.",
    image:
      "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/assets/images/Daniel_Monettelli.png",
    tags: ["ASP.NET Core", "MVC Razor", ".NET MAUI", "MongoDB", "Geolocalización"],
    links: [],
    featured: false,
    status: "In Development",
    projectType: "Full Stack Web + Mobile Platform",
    role: "Full Stack Developer and solution designer",
    screenshots: [],
    problemSolved:
      "Pet owners in Peru face great difficulty when planning trips: there is no centralized platform to find hotels, restaurants, and tourism services that accept pets. Information is scattered and unreliable.",
    myContribution:
      "I designed the complete system architecture and developed all three modules: REST API with ASP.NET Core, web interface with MVC Razor Views, and cross-platform mobile app with .NET MAUI. Implemented geospatial queries in MongoDB for proximity-based establishment search.",
    fullDescription:
      "Pioneer platform that solves a real problem in the Peruvian tourism market: the difficulty of finding establishments and services that accept pets. Combines a robust ASP.NET Core backend with a MVC Razor Views web interface and a cross-platform .NET MAUI mobile application, using MongoDB for flexible geospatial data management.",
    keyFeatures: [
      "RESTful API with ASP.NET Core and token-based authentication (JWT)",
      "Responsive web interface with MVC Razor Views, Bootstrap, and server-side validation",
      "Cross-platform mobile app with .NET MAUI for iOS and Android",
      "MongoDB with geospatial indexes (2dsphere) for proximity search",
      "Pet profile management with personalized travel preferences",
      "Review and rating system for pet-friendly establishments",
    ],
    achievements: [
      "Solution to a real unsolved problem in the Peruvian tourism market",
      "Functional implementation of geospatial queries with MongoDB",
      "Complete Full Stack architecture with 3 distinct presentation layers",
    ],
    architecture:
      "Modular monolithic architecture with ASP.NET Core as the central core.",
    architectureLayers: [
      { layer: "API (ASP.NET Core)", detail: "REST controllers, authentication middleware, dependency injection" },
      { layer: "Web (MVC Razor)", detail: "Compiled Razor views, Tag Helpers, form validation" },
      { layer: "Mobile (.NET MAUI)", detail: "HTTP client, MVVM, Shell navigation, and platform-specific UI" },
      { layer: "Data (MongoDB)", detail: "Collections with flexible schemas, geospatial indexes, aggregations" },
    ],
    impact:
      "First project to address the digital gap in pet-friendly tourism in Peru, with potential for regional expansion.",
  },
  {
    title: "MonettelliUIKIT",
    subtitle: "Architecture Template — Clean UI",
    description:
      "Multi-project template for iOS, Android, and Windows based on Clean UI Architecture, optimizing maintainability in Xamarin.Forms.",
    image:
      "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/assets/images/Daniel_Monettelli.png",
    tags: ["Xamarin.Forms", ".NET MAUI", "Clean Architecture", "MVVM", "NuGet"],
    links: [
      {
        label: "GitHub",
        url: "https://github.com/danielmonettelli/MonettelliUIKIT",
        icon: "github",
      },
    ],
    featured: false,
    status: "Completed",
    projectType: "Open Source Architecture Template",
    role: "Creator and open source project maintainer",
    screenshots: [],
    problemSolved:
      "When starting Xamarin.Forms projects, developers faced repetitive configurations, inconsistent folder structure, and disorganized mixing of styles, controls, and behaviors. There was no template with a clear architecture for the UI layer.",
    myContribution:
      "I designed and published Clean UI Architecture: a proprietary methodology that separates UI responsibilities into 4 pillars — Themes, Controls, Converters, and Behaviors. Created the complete multi-project template, wrote the usage documentation, and maintained the repository as a community reference.",
    fullDescription:
      "Multi-project architectural template designed to accelerate Xamarin.Forms application development (now migratable to .NET MAUI). Implements Clean UI Architecture, a proprietary methodology that separates UI responsibilities into maintainable and reusable layers, allowing developers to start projects with a solid and well-organized foundation.",
    keyFeatures: [
      "Complete cross-platform support: iOS, Android, and Windows from a single project",
      "Clean UI Architecture: Themes, Controls, Converters, and Behaviors as separate pillars",
      "Reusable, extensible, and documented UI components",
      "Ready-to-use project templates with professional structure",
      "Verified compatibility with migration to .NET MAUI",
      "Complete documentation with step-by-step implementation guide",
    ],
    achievements: [
      "Open source project adopted by developers in the Xamarin community",
      "Clean UI Architecture methodology referenced in technical forums",
      "~60% reduction in initial setup time for new projects",
    ],
    architecture:
      "Proprietary Clean UI Architecture with 4 vertical separation pillars.",
    architectureLayers: [
      { layer: "Themes", detail: "Global XAML resources, color palettes, typographic styles" },
      { layer: "Controls", detail: "Customized and reusable UI components with bindable properties" },
      { layer: "Converters", detail: "IValueConverter implementations for data transformations in binding" },
      { layer: "Behaviors", detail: "Reusable behaviors for validation, animations, and interactions" },
    ],
    impact:
      "Established an architectural standard for the UI layer in Xamarin.Forms projects, adopted by developers seeking professional structure.",
  },
  {
    title: "MauiUX Guide",
    subtitle: "Educational UI/UX Platform — .NET MAUI",
    description:
      "Educational project focused on mastering high-level user interfaces and experiences in .NET MAUI.",
    image:
      "https://raw.githubusercontent.com/danielmonettelli/danielmonettelli.github.io/main/assets/images/Daniel_Monettelli.png",
    tags: [".NET MAUI", "UI/UX", "XAML", "Handlers", "Community Toolkit"],
    links: [],
    featured: false,
    status: "In Development",
    projectType: "Open Source Educational Project",
    role: "Creator, technical educator, and content author",
    screenshots: [],
    problemSolved:
      "Most .NET MAUI resources focus on functionality, leaving a gap in professional UI/UX. Developers lack specific guides for creating interfaces that compete with native apps designed by professional design teams.",
    myContribution:
      "I am creating a collection of guides, functional examples, and design patterns that demonstrate how to achieve professional-level UI/UX in .NET MAUI without relying on third-party libraries, using the framework's native capabilities.",
    fullDescription:
      "Educational project focused on raising the UI/UX standard within the .NET MAUI ecosystem. Documents advanced design patterns, reference implementations with fluid animations, and accessibility best practices for creating professional interfaces and memorable user experiences in cross-platform applications.",
    keyFeatures: [
      "Detailed UI/UX guides specific to .NET MAUI with functional code",
      "Reference implementations of fluid animations and transitions",
      "Advanced mobile design patterns adapted to the .NET ecosystem",
      "Accessibility and responsive design best practices for cross-platform",
      "Advanced techniques with Handlers and Custom Renderers",
      "Integration with Community Toolkit for extended components",
    ],
    achievements: [
      "Reference educational resource for the .NET MAUI community",
      "Promotion of professional quality standards in mobile UI/UX",
      "Active contribution to the growth of the .NET MAUI ecosystem",
    ],
    architecture:
      "Example projects with MVVM, focus on the presentation layer.",
    architectureLayers: [
      { layer: "Presentation", detail: "Advanced XAML views with animations, gradients, and complex layouts" },
      { layer: "Custom Handlers", detail: "Native per-platform handlers for customized controls" },
      { layer: "Community Toolkit", detail: "Integration with CommunityToolkit.Maui for extensions" },
      { layer: "Accessibility", detail: "SemanticProperties, AutomationProperties, and accessibility testing" },
    ],
    impact:
      "Fills the gap in professional UI/UX resources in the .NET MAUI ecosystem, raising the community's quality standard.",
  },
];

function getStatusColor(status: string): string {
  if (status === "Published" || status === "Publicado") return "text-emerald-400 bg-emerald-400/10";
  if (status === "In Development" || status === "En Desarrollo") return "text-amber-400 bg-amber-400/10";
  if (status === "Completed" || status === "Completado") return "text-emerald-400 bg-emerald-400/10";
  return "text-white/50 bg-white/5";
}
---

<section id="projects" class="relative py-24 lg:py-32">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-16 reveal-up">
      <p class="mui-overline" data-i18n="projects.overline">Projects</p>
      <h2 class="mui-h2" data-i18n-html="projects.titleHtml">
        What I've <span class="gradient-text">built</span>
      </h2>
      <p class="mt-4 max-w-2xl mx-auto text-sm sm:text-base" style="color: var(--mui-text-muted);" data-i18n="projects.description">
        Engineering and innovation projects that reflect my commitment
        to clean, scalable, and functional software.
      </p>
    </div>

    <!-- Featured Projects — entire card clickable -->
    <div class="grid lg:grid-cols-2 gap-6 mb-8">
      {projects
        .filter((p) => p.featured)
        .map((project) => {
          const projectIndex = projects.indexOf(project);
          return (
          <div
            class="tilt-card reveal-scale group cursor-pointer"
            data-project-index={projectIndex}
            role="button"
            tabindex="0"
            aria-label={`View details of ${project.title}`}
          >
            <div class="tilt-card-inner mui-card rounded-3xl overflow-hidden transition-all duration-500">
              {/* Image */}
              <div class="relative h-48 sm:h-56 overflow-hidden">
                <img
                  src={project.image}
                  alt={project.title}
                  class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                  width="640"
                  height="224"
                  loading="lazy"
                  decoding="async"
                />
                <div class="absolute inset-0" style="background: linear-gradient(to top, var(--mui-bg) 0%, rgba(0,0,0,0.3) 50%, transparent 100%);" />
                {/* Status badge */}
                <div class="absolute top-4 right-4">
                  <span
                    class:list={[
                      "px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider",
                      getStatusColor(project.status),
                    ]}
                    data-i18n={`projects.${projectIndex}_status`}
                  >
                    {project.status}
                  </span>
                </div>
                {/* Featured badge */}
                <div class="absolute top-4 left-4">
                  <span class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider" style="color: var(--mui-primary); background: var(--mui-primary-bg);" data-i18n="projects.featured">
                    ⭐ Featured
                  </span>
                </div>
              </div>

              <div class="p-6 sm:p-8">
                <p class="text-xs uppercase tracking-wider mb-1" style="color: var(--mui-text-disabled);" data-i18n={`projects.${projectIndex}_subtitle`}>
                  {project.subtitle}
                </p>
                <h3 class="text-xl sm:text-2xl font-bold mb-3 transition-colors" style="color: var(--mui-text-primary);">
                  {project.title}
                </h3>
                <p class="text-sm leading-relaxed mb-5" style="color: var(--mui-text-secondary);" data-i18n={`projects.${projectIndex}_description`}>
                  {project.description}
                </p>

                {/* Tags */}
                <div class="flex flex-wrap gap-2 mb-5">
                  {project.tags.map((tag) => (
                    <span class="px-2.5 py-1 rounded-lg text-[10px] font-medium" style="color: var(--mui-primary); background: var(--mui-primary-bg); border: 1px solid var(--mui-border-subtle);">
                      {tag}
                    </span>
                  ))}
                </div>

                {/* Links row — stop propagation so link clicks don't open modal */}
                <div class="flex items-center gap-3 flex-wrap project-links-row">
                  {project.links.length > 0 && (
                    project.links.map((link) => (
                      <a
                        href={link.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="mui-btn-secondary mui-btn-sm project-external-link"
                      >
                        {link.icon === "github" ? (
                          <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z" />
                          </svg>
                        ) : (
                          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                          </svg>
                        )}
                        {link.label}
                      </a>
                    ))
                  )}
                  {/* Visual hint for clickable card */}
                  <span class="ml-auto text-xs font-medium transition-colors opacity-60 group-hover:opacity-100 flex items-center gap-1.5" style="color: var(--mui-primary);" aria-hidden="true">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                    <span data-i18n="projects.viewDetails">View details</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          );
        })}
    </div>

    <!-- Other Projects Grid — entire card clickable -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5 stagger-children">
      {projects
        .filter((p) => !p.featured)
        .map((project) => {
          const projectIndex = projects.indexOf(project);
          return (
          <div
            class="tilt-card group cursor-pointer"
            data-project-index={projectIndex}
            role="button"
            tabindex="0"
            aria-label={`View details of ${project.title}`}
          >
            <div class="tilt-card-inner mui-paper rounded-2xl p-6 h-full transition-all duration-500 flex flex-col">
              {/* Header */}
              <div class="flex items-center justify-between mb-3">
                <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: var(--mui-primary-bg);">
                  <svg class="w-5 h-5" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                  </svg>
                </div>
                <span
                  class:list={[
                    "px-2.5 py-0.5 rounded-full text-[10px] font-semibold",
                    getStatusColor(project.status),
                  ]}
                  data-i18n={`projects.${projectIndex}_status`}
                >
                  {project.status}
                </span>
              </div>

              <p class="text-[10px] uppercase tracking-wider mb-1" style="color: var(--mui-text-disabled);" data-i18n={`projects.${projectIndex}_subtitle`}>
                {project.subtitle}
              </p>
              <h3 class="text-lg font-bold mb-2 transition-colors" style="color: var(--mui-text-primary);">
                {project.title}
              </h3>
              <p class="text-xs leading-relaxed mb-auto pb-4" style="color: var(--mui-text-secondary);" data-i18n={`projects.${projectIndex}_description`}>
                {project.description}
              </p>

              <div class="flex flex-wrap gap-1.5 mb-4">
                {project.tags.slice(0, 4).map((tag) => (
                  <span class="px-2 py-0.5 rounded text-[9px] font-medium" style="color: var(--mui-text-disabled); background: var(--mui-bg-subtle);">
                    {tag}
                  </span>
                ))}
              </div>

              <div class="flex items-center gap-2 pt-4 flex-wrap project-links-row" style="border-top: 1px solid var(--mui-border-subtle);">
                {project.links.length > 0 && (
                  project.links.map((link) => (
                    <a
                      href={link.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-xs transition-colors project-external-link"
                      style="color: var(--mui-primary);"
                    >
                      {link.label} ↗
                    </a>
                  ))
                )}
                <span class="text-xs font-semibold ml-auto opacity-60 group-hover:opacity-100 transition-opacity flex items-center gap-1" style="color: var(--mui-primary);" aria-hidden="true">
                  <span data-i18n="projects.viewDetails">View details</span>
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                  </svg>
                </span>
              </div>
            </div>
          </div>
          );
        })}
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════════════════
       NEAR-FULLSCREEN PROJECT DETAIL MODAL
       95vw × 92vh — strategic recruiter-oriented layout
       ═══════════════════════════════════════════════════════════════ -->
  <div id="project-modal-overlay" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="modal-top-title-text">
    {/* Backdrop */}
    <div class="absolute inset-0 transition-opacity duration-300" id="modal-backdrop" style="background: hsla(210, 14%, 4%, 0.8); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);" aria-hidden="true"></div>

    {/* Modal Container — centered with inset spacing */}
    <div class="relative flex items-center justify-center min-h-screen p-3 sm:p-4 lg:p-6">
      <div
        id="project-modal-content"
        class="relative w-[95vw] max-w-[1400px] max-h-[92vh] rounded-3xl overflow-hidden flex flex-col transition-all duration-300"
        style="background: var(--mui-bg-paper); border: 1px solid var(--mui-card-border); box-shadow: 0 25px 80px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255,255,255,0.05);"
      >
        {/* ── Sticky top bar with close button ── */}
        <div class="sticky top-0 z-20 flex items-center justify-between px-6 sm:px-8 py-4 shrink-0" style="background: var(--mui-bg-paper); border-bottom: 1px solid var(--mui-border-subtle);">
          <div id="modal-top-title" class="flex items-center gap-3 min-w-0">
            <div class="w-8 h-8 rounded-lg flex items-center justify-center shrink-0" style="background: var(--mui-primary-bg);">
              <svg class="w-4 h-4" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
              </svg>
            </div>
            <span class="text-sm font-bold truncate" style="color: var(--mui-text-primary);" id="modal-top-title-text"></span>
          </div>
          <button
            id="modal-close-btn"
            class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 cursor-pointer shrink-0 hover:scale-110"
            style="background: var(--mui-bg-subtle); color: var(--mui-text-secondary); border: 1px solid var(--mui-border-subtle);"
            aria-label="Close modal"
            data-i18n-aria="projects.closeModal"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        {/* ── Scrollable content area ── */}
        <div id="modal-scroll-area" class="flex-1 overflow-y-auto overscroll-contain">
          {projects.map((project, index) => (
            <div data-modal-project={index} class="hidden">

              {/* ═══ HERO BANNER ═══ */}
              <div class="relative h-56 sm:h-72 lg:h-80 overflow-hidden">
                <img
                  src={project.image}
                  alt={project.title}
                  class="w-full h-full object-cover"
                  width="1400"
                  height="320"
                  loading="lazy"
                  decoding="async"
                />
                <div class="absolute inset-0" style="background: linear-gradient(to top, var(--mui-bg-paper) 0%, rgba(0,0,0,0.15) 40%, transparent 100%);" />
                {/* Badges over image */}
                <div class="absolute top-5 left-6 flex gap-2">
                  <span
                    class:list={[
                      "px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider",
                      getStatusColor(project.status),
                    ]}
                    data-i18n={`projects.${index}_status`}
                  >
                    {project.status}
                  </span>
                  {project.featured && (
                    <span class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider" style="color: var(--mui-primary); background: var(--mui-primary-bg);" data-i18n="projects.featured">
                      ⭐ Featured
                    </span>
                  )}
                </div>
              </div>

              {/* ═══ MAIN CONTENT ═══ */}
              <div class="px-6 sm:px-10 lg:px-14 pb-10 lg:pb-14 -mt-8 relative">

                {/* ── Title block ── */}
                <div class="mb-8 lg:mb-10">
                  <p class="text-xs uppercase tracking-wider mb-1.5" style="color: var(--mui-text-disabled);" data-i18n={`projects.${index}_subtitle`}>
                    {project.subtitle}
                  </p>
                  <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold font-display mb-2" style="color: var(--mui-text-primary);" data-i18n={`projects.${index}_title`}>
                    {project.title}
                  </h3>
                  <p class="text-sm sm:text-base font-semibold" style="color: var(--mui-primary);" data-i18n={`projects.${index}_projectType`}>
                    {project.projectType}
                  </p>
                </div>

                {/* ── SCREENSHOT GALLERY — visual showcase for recruiters ── */}
                {project.screenshots.length > 0 && (
                  <div class="mb-10">
                    <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-4" style="color: var(--mui-text-primary);">
                      <svg class="w-4 h-4" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                      <span data-i18n="projects.screenshots">Project Screenshots</span>
                      <span class="text-[10px] font-normal ml-1" style="color: var(--mui-text-muted);" data-i18n="projects.screenshotsHint">
                        — Click an image to enlarge
                      </span>
                    </h4>
                    {/* Filmstrip — horizontal scroll */}
                    <div class="flex gap-3 overflow-x-auto pb-3 -mx-2 px-2 snap-x snap-mandatory gallery-strip" style="scrollbar-width: thin; scrollbar-color: var(--mui-border-subtle) transparent;">
                      {project.screenshots.map((shot, shotIdx) => (
                        <button
                          class="gallery-thumb relative shrink-0 w-56 sm:w-64 lg:w-72 aspect-[4/3] rounded-xl overflow-hidden cursor-pointer group/thumb transition-all duration-300 snap-start"
                          style="border: 2px solid var(--mui-border-subtle);"
                          data-gallery-idx={shotIdx}
                          aria-label={`Enlarge: ${shot.alt}`}
                        >
                          <img
                            src={shot.src}
                            alt={shot.alt}
                            class="w-full h-full object-cover transition-transform duration-500 group-hover/thumb:scale-105"
                            loading="lazy"
                            decoding="async"
                          />
                          {/* Hover overlay */}
                          <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover/thumb:opacity-100 transition-opacity duration-300" style="background: hsla(210, 14%, 4%, 0.5);">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: var(--mui-primary); color: white;">
                              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
                              </svg>
                            </div>
                          </div>
                          {/* Caption */}
                          <div class="absolute bottom-0 left-0 right-0 px-3 py-2" style="background: linear-gradient(to top, hsla(210, 14%, 4%, 0.85), transparent);">
                            <p class="text-[10px] sm:text-[11px] leading-snug text-white/90 line-clamp-2">
                              {shot.alt}
                            </p>
                          </div>
                        </button>
                      ))}
                    </div>

                    {/* ── Expanded image viewer (hidden by default) ── */}
                    <div class="gallery-expanded hidden mt-4 rounded-2xl overflow-hidden relative" style="border: 1px solid var(--mui-border-subtle); background: var(--mui-bg-subtle);">
                      <div class="relative">
                        <img
                          class="gallery-expanded-img w-full max-h-[60vh] object-contain"
                          src=""
                          alt=""
                          loading="lazy"
                          decoding="async"
                        />
                        {/* Close expanded */}
                        <button
                          class="gallery-expanded-close absolute top-3 right-3 w-9 h-9 rounded-full flex items-center justify-center cursor-pointer transition-all duration-200 hover:scale-110"
                          style="background: hsla(210, 14%, 4%, 0.7); color: white; backdrop-filter: blur(4px);"
                          aria-label="Close expanded view"
                        >
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        </button>
                        {/* Navigation arrows */}
                        <button
                          class="gallery-prev absolute left-3 top-1/2 -translate-y-1/2 w-9 h-9 rounded-full flex items-center justify-center cursor-pointer transition-all duration-200 hover:scale-110"
                          style="background: hsla(210, 14%, 4%, 0.7); color: white; backdrop-filter: blur(4px);"
                          aria-label="Previous image"
                        >
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                          </svg>
                        </button>
                        <button
                          class="gallery-next absolute right-3 top-1/2 -translate-y-1/2 w-9 h-9 rounded-full flex items-center justify-center cursor-pointer transition-all duration-200 hover:scale-110"
                          style="background: hsla(210, 14%, 4%, 0.7); color: white; backdrop-filter: blur(4px);"
                          aria-label="Next image"
                        >
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                          </svg>
                        </button>
                      </div>
                      {/* Caption bar */}
                      <div class="px-4 py-3 flex items-center justify-between" style="border-top: 1px solid var(--mui-border-subtle);">
                        <p class="gallery-expanded-caption text-xs sm:text-sm" style="color: var(--mui-text-secondary);"></p>
                        <span class="gallery-expanded-counter text-[10px] font-bold shrink-0 ml-3" style="color: var(--mui-text-disabled);"></span>
                      </div>
                    </div>
                  </div>
                )}

                {/* ── TWO-COLUMN STRATEGIC LAYOUT (lg+) ── */}
                <div class="grid lg:grid-cols-5 gap-8 lg:gap-12">

                  {/* LEFT COLUMN — 3/5 width: narrative content */}
                  <div class="lg:col-span-3 space-y-8">

                    {/* Visión General */}
                    <div>
                      <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--mui-text-primary);">
                        <svg class="w-4 h-4" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                        <span data-i18n="projects.overview">Overview</span>
                      </h4>
                      <p class="text-sm sm:text-base leading-relaxed" style="color: var(--mui-text-secondary);" data-i18n={`projects.${index}_fullDescription`}>
                        {project.fullDescription}
                      </p>
                    </div>

                    {/* El Problema que Resuelve */}
                    <div class="p-5 rounded-2xl" style="background: var(--mui-bg-subtle); border: 1px solid var(--mui-border-subtle);">
                      <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--mui-text-primary);">
                        <svg class="w-4 h-4" style="color: var(--color-amber-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4.5c-.77-.833-2.694-.833-3.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z" />
                        </svg>
                        <span data-i18n="projects.problemSolved">Problem Solved</span>
                      </h4>
                      <p class="text-sm leading-relaxed" style="color: var(--mui-text-secondary);" data-i18n={`projects.${index}_problemSolved`}>
                        {project.problemSolved}
                      </p>
                    </div>

                    {/* Mi Contribución */}
                    <div class="p-5 rounded-2xl" style="background: var(--mui-primary-bg); border: 1px solid var(--mui-border-subtle);">
                      <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--mui-text-primary);">
                        <svg class="w-4 h-4" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        <span data-i18n="projects.myContribution">My Contribution</span>
                      </h4>
                      <p class="text-sm leading-relaxed" style="color: var(--mui-text-secondary);" data-i18n={`projects.${index}_myContribution`}>
                        {project.myContribution}
                      </p>
                    </div>

                    {/* Características Clave */}
                    <div>
                      <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-4" style="color: var(--mui-text-primary);">
                        <svg class="w-4 h-4" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                        </svg>
                        <span data-i18n="projects.keyFeatures">Key Features</span>
                      </h4>
                      <div class="grid sm:grid-cols-2 gap-3">
                        {project.keyFeatures.map((feature, featureIdx) => (
                          <div class="flex items-start gap-3 p-3 rounded-xl" style="background: var(--mui-bg-subtle);">
                            <div class="mt-1 w-2 h-2 rounded-full shrink-0" style="background: var(--mui-primary);" />
                            <p class="text-xs sm:text-sm leading-relaxed" style="color: var(--mui-text-secondary);" data-i18n={`projects.${index}_feature${featureIdx}`}>
                              {feature}
                            </p>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Impacto */}
                    <div class="p-5 rounded-2xl" style="border: 2px solid var(--mui-border-subtle);">
                      <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--mui-text-primary);">
                        <svg class="w-4 h-4" style="color: var(--color-emerald-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        <span data-i18n="projects.impact">Impact</span>
                      </h4>
                      <p class="text-sm leading-relaxed" style="color: var(--mui-text-secondary);" data-i18n={`projects.${index}_impact`}>
                        {project.impact}
                      </p>
                    </div>
                  </div>

                  {/* RIGHT COLUMN — 2/5 width: structured data */}
                  <div class="lg:col-span-2 space-y-6">

                    {/* Arquitectura */}
                    <div class="p-5 rounded-2xl" style="background: var(--mui-bg-subtle); border: 1px solid var(--mui-border-subtle);">
                      <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--mui-text-primary);">
                        <svg class="w-4 h-4" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <polygon points="12 2 2 7 12 12 22 7 12 2" />
                          <polyline points="2 17 12 22 22 17" />
                          <polyline points="2 12 12 17 22 12" />
                        </svg>
                        <span data-i18n="projects.architecture">Architecture</span>
                      </h4>
                      <p class="text-xs leading-relaxed mb-4" style="color: var(--mui-text-secondary);" data-i18n={`projects.${index}_arch`}>
                        {project.architecture}
                      </p>
                      {/* Layer diagram */}
                      <div class="space-y-2">
                        {project.architectureLayers.map((item, layerIdx) => (
                          <div class="p-3 rounded-xl transition-colors" style="background: var(--mui-bg-paper); border: 1px solid var(--mui-border-subtle);">
                            <div class="flex items-center gap-2 mb-1">
                              <div class="w-5 h-5 rounded flex items-center justify-center text-[10px] font-bold shrink-0" style="background: var(--mui-primary); color: white;">
                                {layerIdx + 1}
                              </div>
                              <span class="text-xs font-bold" style="color: var(--mui-text-primary);" data-i18n={`projects.${index}_layer${layerIdx}`}>
                                {item.layer}
                              </span>
                            </div>
                            <p class="text-[11px] leading-relaxed pl-7" style="color: var(--mui-text-muted);" data-i18n={`projects.${index}_layer${layerIdx}_detail`}>
                              {item.detail}
                            </p>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Stack Técnico */}
                    <div>
                      <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--mui-text-primary);">
                        <svg class="w-4 h-4" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                        </svg>
                        <span data-i18n="projects.techStack">Tech Stack</span>
                      </h4>
                      <div class="flex flex-wrap gap-2">
                        {project.tags.map((tag) => (
                          <span class="px-3 py-1.5 rounded-lg text-xs font-semibold" style="color: var(--mui-primary); background: var(--mui-primary-bg); border: 1px solid var(--mui-border-subtle);">
                            {tag}
                          </span>
                        ))}
                      </div>
                    </div>

                    {/* Logros Destacados */}
                    <div>
                      <h4 class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--mui-text-primary);">
                        <svg class="w-4 h-4" style="color: var(--mui-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                        </svg>
                        <span data-i18n="projects.achievements">Key Achievements</span>
                      </h4>
                      <div class="space-y-2.5">
                        {project.achievements.map((achievement, achIdx) => (
                          <div class="flex items-start gap-2.5">
                            <svg class="w-4 h-4 mt-0.5 shrink-0" style="color: var(--color-emerald-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            <p class="text-xs sm:text-sm leading-relaxed" style="color: var(--mui-text-secondary);" data-i18n={`projects.${index}_achievement${achIdx}`}>
                              {achievement}
                            </p>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Links / CTAs */}
                    {project.links.length > 0 && (
                      <div class="pt-4" style="border-top: 1px solid var(--mui-border-subtle);">
                        <div class="flex flex-col gap-2">
                          {project.links.map((link) => (
                            <a
                              href={link.url}
                              target="_blank"
                              rel="noopener noreferrer"
                              class="mui-btn-contained mui-btn-md w-full justify-center"
                            >
                              {link.icon === "github" ? (
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                  <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z" />
                                </svg>
                              ) : link.icon === "play" ? (
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                              ) : (
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                              )}
                              {link.label}
                            </a>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import anime from "animejs";

  // 3D Tilt effect on project cards
  document.querySelectorAll<HTMLElement>(".tilt-card").forEach((card) => {
    const inner = card.querySelector(".tilt-card-inner") as HTMLElement;
    if (!inner) return;

    card.addEventListener("mousemove", (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const rotateX = ((y - centerY) / centerY) * -5;
      const rotateY = ((x - centerX) / centerX) * 5;

      anime({
        targets: inner,
        rotateX: rotateX,
        rotateY: rotateY,
        duration: 400,
        easing: "easeOutQuad",
      });
    });

    card.addEventListener("mouseleave", () => {
      anime({
        targets: inner,
        rotateX: 0,
        rotateY: 0,
        duration: 600,
        easing: "easeOutElastic(1, 0.6)",
      });
    });
  });

  // ── Near-Fullscreen Project Detail Modal ──
  const overlay = document.getElementById("project-modal-overlay");
  const backdrop = document.getElementById("modal-backdrop");
  const closeBtn = document.getElementById("modal-close-btn");
  const modalContent = document.getElementById("project-modal-content");
  const modalScrollArea = document.getElementById("modal-scroll-area");
  const modalTopTitle = document.getElementById("modal-top-title-text");
  const modalPanels = document.querySelectorAll<HTMLElement>("[data-modal-project]");

  // Project titles for the sticky header
  const projectTitles = Array.from(
    document.querySelectorAll<HTMLElement>("[data-modal-project] h3")
  ).map((h3) => h3.textContent || "");

  // Focus management
  let previouslyFocusedElement: HTMLElement | null = null;

  function trapFocus(e: KeyboardEvent): void {
    if (e.key !== "Tab" || !modalContent) return;

    const focusableEls = modalContent.querySelectorAll<HTMLElement>(
      'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'
    );
    if (focusableEls.length === 0) return;

    const firstEl = focusableEls[0];
    const lastEl = focusableEls[focusableEls.length - 1];

    if (e.shiftKey) {
      if (document.activeElement === firstEl) {
        e.preventDefault();
        lastEl.focus();
      }
    } else {
      if (document.activeElement === lastEl) {
        e.preventDefault();
        firstEl.focus();
      }
    }
  }

  function openModal(projectIndex: number): void {
    if (!overlay) return;

    // Save the element that triggered the modal for focus restoration
    previouslyFocusedElement = document.activeElement as HTMLElement;

    // Hide all panels, show the target
    modalPanels.forEach((panel) => {
      panel.classList.add("hidden");
      if (panel.dataset.modalProject === String(projectIndex)) {
        panel.classList.remove("hidden");
      }
    });

    // Update sticky header title
    if (modalTopTitle) {
      modalTopTitle.textContent = projectTitles[projectIndex] || "";
    }

    // Scroll to top of modal content
    if (modalScrollArea) {
      modalScrollArea.scrollTop = 0;
    }

    // Show overlay
    overlay.classList.remove("hidden");
    document.body.style.overflow = "hidden";

    // Animate in
    anime({
      targets: backdrop,
      opacity: [0, 1],
      duration: 300,
      easing: "easeOutQuad",
    });

    anime({
      targets: modalContent,
      opacity: [0, 1],
      translateY: [50, 0],
      scale: [0.92, 1],
      duration: 450,
      easing: "easeOutCubic",
      delay: 80,
      complete: () => {
        // Move focus to close button after animation
        closeBtn?.focus();
        // Enable focus trap
        document.addEventListener("keydown", trapFocus);
      },
    });
  }

  function closeModal(): void {
    if (!overlay) return;

    // Remove focus trap
    document.removeEventListener("keydown", trapFocus);

    anime({
      targets: modalContent,
      opacity: [1, 0],
      translateY: [0, 40],
      scale: [1, 0.95],
      duration: 250,
      easing: "easeInQuad",
    });

    anime({
      targets: backdrop,
      opacity: [1, 0],
      duration: 300,
      easing: "easeInQuad",
      complete: () => {
        overlay.classList.add("hidden");
        document.body.style.overflow = "";
        // Restore focus to the element that opened the modal
        previouslyFocusedElement?.focus();
        previouslyFocusedElement = null;
      },
    });
  }

  // ── Attach click handlers to ALL tilt-cards (entire card is clickable) ──
  document.querySelectorAll<HTMLElement>(".tilt-card[data-project-index]").forEach((card) => {
    card.addEventListener("click", (e) => {
      // Don't open modal if clicking an external link
      const target = e.target as HTMLElement;
      if (target.closest(".project-external-link")) return;

      e.preventDefault();
      const index = parseInt(card.dataset.projectIndex || "0", 10);
      openModal(index);
    });

    // Also open on Enter/Space for keyboard accessibility
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        const index = parseInt(card.dataset.projectIndex || "0", 10);
        openModal(index);
      }
    });
  });

  // Stop external link clicks from propagating to card
  document.querySelectorAll<HTMLElement>(".project-external-link").forEach((link) => {
    link.addEventListener("click", (e) => {
      e.stopPropagation();
    });
  });

  // Close on backdrop click
  backdrop?.addEventListener("click", closeModal);

  // Close on button click
  closeBtn?.addEventListener("click", closeModal);

  // Close on Escape key
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && overlay && !overlay.classList.contains("hidden")) {
      closeModal();
    }
  });

  // Prevent clicks inside modal content from closing
  modalContent?.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  // ── Screenshot Gallery — lightbox within modal ──
  document.querySelectorAll<HTMLElement>("[data-modal-project]").forEach((panel) => {
    const thumbs = panel.querySelectorAll<HTMLElement>(".gallery-thumb");
    const expanded = panel.querySelector<HTMLElement>(".gallery-expanded");
    const expandedImg = panel.querySelector<HTMLImageElement>(".gallery-expanded-img");
    const expandedCaption = panel.querySelector<HTMLElement>(".gallery-expanded-caption");
    const expandedCounter = panel.querySelector<HTMLElement>(".gallery-expanded-counter");
    const closeExpanded = panel.querySelector<HTMLElement>(".gallery-expanded-close");
    const prevBtn = panel.querySelector<HTMLElement>(".gallery-prev");
    const nextBtn = panel.querySelector<HTMLElement>(".gallery-next");

    if (!thumbs.length || !expanded || !expandedImg) return;

    // Build screenshots array from thumbs
    const shots: { src: string; alt: string }[] = [];
    thumbs.forEach((t) => {
      const img = t.querySelector("img");
      if (img) shots.push({ src: img.src, alt: img.alt });
    });

    let currentIdx = 0;

    function showExpanded(idx: number): void {
      if (idx < 0 || idx >= shots.length) return;
      currentIdx = idx;
      expandedImg!.src = shots[idx].src;
      expandedImg!.alt = shots[idx].alt;
      if (expandedCaption) expandedCaption.textContent = shots[idx].alt;
      if (expandedCounter)
        expandedCounter.textContent = `${idx + 1} / ${shots.length}`;

      expanded!.classList.remove("hidden");

      // Highlight active thumb
      thumbs.forEach((t, i) => {
        (t as HTMLElement).style.borderColor =
          i === idx ? "var(--mui-primary)" : "var(--mui-border-subtle)";
        (t as HTMLElement).style.opacity = i === idx ? "1" : "0.6";
      });

      // Animate in
      anime({
        targets: expanded,
        opacity: [0, 1],
        translateY: [12, 0],
        duration: 300,
        easing: "easeOutQuad",
      });
    }

    function hideExpanded(): void {
      expanded!.classList.add("hidden");
      thumbs.forEach((t) => {
        (t as HTMLElement).style.borderColor = "var(--mui-border-subtle)";
        (t as HTMLElement).style.opacity = "1";
      });
    }

    // Thumb clicks
    thumbs.forEach((thumb, idx) => {
      thumb.addEventListener("click", (e) => {
        e.stopPropagation();
        showExpanded(idx);
      });
    });

    // Close expanded
    closeExpanded?.addEventListener("click", (e) => {
      e.stopPropagation();
      hideExpanded();
    });

    // Navigation
    prevBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      showExpanded(currentIdx > 0 ? currentIdx - 1 : shots.length - 1);
    });

    nextBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      showExpanded(currentIdx < shots.length - 1 ? currentIdx + 1 : 0);
    });

    // Keyboard navigation for gallery
    panel.addEventListener("keydown", (e) => {
      if (expanded.classList.contains("hidden")) return;
      if (e.key === "ArrowLeft") {
        e.preventDefault();
        showExpanded(currentIdx > 0 ? currentIdx - 1 : shots.length - 1);
      } else if (e.key === "ArrowRight") {
        e.preventDefault();
        showExpanded(currentIdx < shots.length - 1 ? currentIdx + 1 : 0);
      } else if (e.key === "Escape") {
        e.preventDefault();
        e.stopPropagation();
        hideExpanded();
      }
    });
  });
</script>
